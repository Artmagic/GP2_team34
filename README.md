Анализ благоприятных зон для открытия кафе в Москве

Учебный проект по оценке привлекательности разных зон Москвы (в пределах МКАД) для открытия кафе. Основная идея — разбить город на квадраты 800×800 м, собрать по ним внешние признаки и посчитать интегральный индекс привлекательности.

Цели
- Определить потенциально выгодные районы для открытия кафе.
- Выделить факторы, которые сильнее всего влияют на привлекательность локации.
- Сопоставить проходимость, конкуренцию и стоимость аренды.

Стек технологий

Разработка велась на Python (в основном в Google Colab).
Основные библиотеки: numpy, pandas, geopandas, shapely, osmnx, matplotlib, seaborn, folium, requests, selenium, webdriver_manager, concurrent.futures, logging, re, json, csv.

Структура репозитория

data/
│
├── cian/        # Результаты парсинга CIAN
│
├── food/        # Данные по кафе и ресторанам
│
├── grid/        # Файлы, связанные с построением сетки
│
├── metro/       # Данные по станциям метро
│
└── POI.csv      # Итоговый набор точек интереса (POI)

docs/
└── presentation.pdf      # Презентация

logs/
└── parser_2025-11-05_22-44-21.log      # Лог скрипта о получении рейтинга с 2ГИС

notebooks/
│
├── main_file.ipynb             # Основной ноутбук: сбор всех данных, финальный анализ и расчет индекса
│
├── PointsOfInterest.ipynb      # Сбор и обработка POI (школы, вузы, ТЦ, объекты OSM/2ГИС)
│
├── metro_traffic_final.ipynb   # Расчеты пассажиропотока метро
│
├── openmoscowdata.ipynb        # Сбор данных о предприятиях общепита в Москве
│
└── parking_plus_traffic.ipynb  # Парковки и комбинированные признаки (parking + traffic)

src/
└── cian_parsing_final.py  # Скрипт парсинга CIAN

Данные

1. Сетка Москвы (grid_inside)
- Покрытие: Москва внутри МКАД.
- Размер клетки: 800×800 м (подобран так, чтобы медианное количество кафе на клетку было примерно 5).
- Количество клеток: 1709.
  
Основные поля:
- grid_id — ID клетки.
- geometry — полигон клетки.
- center_lon, center_lat — координаты центра.
- cafe_count — количество кафе.
- total_reviews_count — суммарное число отзывов по кафе.
- average_cafe_rating — средний рейтинг кафе в клетке.
- school_count, university_count, mall_count, poi_count — объекты инфраструктуры.
- chain_cafe_count — количество сетевых кафе.
- distance_to_metro — расстояние до ближайшего метро.
- proximity_to_metro — близость к метро.
- foot_traffic_count, daily_foot_traffic — оценка пешеходного потока.
- walkable_length_m, walkability_index — характеристики улично-пешеходной сети.
- parking_count, parking_density — парковки.
- nearest_metro — ближайшая станция метро.
- metro_flow — пассажиропоток станции.
- avg_price_rent — средняя цена аренды (по ближайшему метро).
- attractiveness_index — итоговый индекс привлекательности клетки.

Для расчёта индекса также использовались нормированные версии признаков (столбцы с суффиксом _norm).

2. Кафе и инфраструктура

Источники:
- Портал открытых данных Правительства Москвы
- 2ГИС

На уровне сырых данных по кафе собирались, в том числе, следующие поля: ID, Name, IsNetObject, OperatingCompany, TypeObject, AdmArea, District, Address, PublicPhone, SeatsCount, SocialPrivileges, Longitude_WGS84, Latitude_WGS84, rating, reviews_count.

По сетке агрегировались:
- cafe_count
- total_reviews_count
- average_cafe_rating
- chain_cafe_count

3. Метро

Источники:
- Портал открытых данных Правительства Москвы
- Wikipedia

Использовались: координаты станций метро, годовой пассажиропоток.

По каждой клетке рассчитывались:
- nearest_metro
- distance_to_metro
- proximity_to_metro
- metro_flow
- daily_foot_traffic

4. Аренда (CIAN)

Собирались объявления по помещениям свободного назначения.

Скрипт: src/cian_parsing_final.py

Основные поля на уровне объявления:
- metro_id
- title
- price
- address
- link

Примерное количество объявлений: около 13 720.

Агрегация:
- Для каждой станции метро считалась средняя цена аренды по найденным объявлениям.
- Для каждой клетки выбиралась средняя цена ближайшего метро.
- Если ближайшее метро находилось дальше 5 км, для этой клетки avg_price_rent оставалось пустым (пропуск).

Пайплайн
1) Общая логика работы проекта:
2) Построение регулярной сетки 800×800 м внутри МКАД.
3) Сбор данных о кафе и инфраструктуре (кафе, школы, вузы, ТЦ, POI, парковки) и их агрегация по клеткам.
4) Сбор данных о метро и пассажиропотоке, привязка станций к клеткам (ближайшая станция, расстояние, поток).
5) Расчёт показателей по уличной сети и walkability внутри каждой клетки.
6) Парсинг CIAN по метро и расчёт средней цены аренды по станциям.
7) Привязка средней цены аренды к клеткам через ближайшие станции метро (при расстоянии до станции не более 5 км).
8) Нормализация ключевых признаков.
9) Расчёт интегрального индекса attractiveness_index.
10) Аналитика и визуализации (тепловые карты и срезы по признакам).

Индекс привлекательности

Итоговый индекс рассчитывался как взвешенная комбинация нормированных признаков:
attractiveness_index =
0.40 * daily_foot_traffic_real_norm +
0.25 * average_cafe_rating_norm +
0.15 * poi_count_norm –
0.30 * chain_cafe_count_norm –
0.30 * cafe_count_norm –
0.20 * avg_price_rent_norm

Смысл коэффициентов:
- Пешеходный поток (daily_foot_traffic_real_norm) повышает индекс.
- Высокий средний рейтинг кафе (average_cafe_rating_norm) трактуется как признак благополучия района.
- Большое количество точек интереса (poi_count_norm) также повышает привлекательность.
- Большое число сетевых кафе (chain_cafe_count_norm) и кафе вообще (cafe_count_norm) воспринимается как конкуренция и снижает индекс.
- Высокая аренда (avg_price_rent_norm) делает открытие кафе менее выгодным, поэтому тоже уменьшает индекс.
- Коэффициенты подбирались эмпирически: смотрели на корреляции признаков и пробовали менять веса, выбирая вариант, который даёт разумную картину по распределению привлекательных зон.

Парсинг CIAN

Основные моменты:
- Используется selenium с ChromeDriver.
- При наличии webdriver_manager драйвер устанавливается автоматически, иначе ожидается, что ChromeDriver уже установлен в системе.

Используются следующие параметры:
- COOKIES_JSON = "cookies.json" — при наличии файла cookies они подгружаются при старте, что помогает реже ловить капчи и блокировки.
- OUTPUT_CSV = "cian_cat_metro.csv" — файл с результатами парсинга.
- HEADLESS — флаг безголового режима (по умолчанию False).
- MAX_PAGES, MAX_SCROLLS — ограничение числа страниц и прокруток.

Логика:
1) Перебираются metro_id в заданном диапазоне.
2) Для каждой станции собираются страницы с объявлениями:
- Формируется URL с параметрами: deal_type=rent, engine_version=2, foot_min=25, offer_type=offices, office_type[0]=5, only_foot=2, region=1 и т.д.
- Страница скроллится несколько раз, по нескольким XPath-паттернам ищутся карточки объявлений.
- Для каждой карточки извлекаются title, price, address, link.
- Дубликаты удаляются по ссылкам (link), чтобы не записывать одно и то же объявление несколько раз.
- Если новая страница не даёт новых объявлений, парсер переходит к следующему metro_id.
3) Логи пишутся через logging (уровень INFO) с указанием станции, страницы и количества найденных карточек.

Работа с API и ограничениями

При сборе данных по объектам инфраструктуры использовался API 2ГИС. У бесплатной версии есть ограничения по числу запросов на один API-ключ, поэтому:
- Было создано около 25 отдельных API-ключей 2ГИС.
- В коде реализована параллельная ротация ключей между запросами.
- Это позволяло распределять нагрузку и избежать постоянных ошибок 429 (Too Many Requests) при большом объёме запросов.

Основные выводы

Наиболее привлекательные зоны — те, где одновременно:
- высокий пешеходный трафик (активные станции метро и насыщенная инфраструктура),
- умеренная конкуренция,
- относительно невысокая аренда.

Центр Москвы по индексу не выглядит оптимальным:
- высокая стоимость аренды,
- сильная конкуренция, включая сетевых игроков.

Зоны на расстоянии примерно 5–10 км от центра часто оказываются более сбалансированными:
- адекватные ставки аренды,
- достаточный поток людей,
- конкуренция есть, но не чрезмерная.

Периферия у МКАД и дальше в среднем менее привлекательна:
- ниже трафик,
- инфраструктура менее развита,
- даже при низкой аренде итоговый индекс часто хуже, чем у районов ближе к центру.

Дальнейшие шаги (возможное развитие)

Добавить ML-модель, которая по признакам клетки будет оценивать потенциальную выручку, вероятность успеха точки.

Авторы
- Арустамян М.
- Раднаев А.
- Сагатов А.
